#  Cíl souboru s hesly
$htpasswdPath = "C:\monitoring\auth\.htpasswd"

#  Seznam uživatelů a hesel
$users = @(
    @{ Username = "risa";  Password = "docker123" },
    @{ Username = "admin"; Password = "secure456" }
)

#  Vytvoření souboru pomocí OpenSSL (APR1 hash)

# Smaže starý soubor, pokud existuje
if (Test-Path $htpasswdPath) {
    Remove-Item $htpasswdPath -Force
}

# Pro každého uživatele vytvoří hash a přidá ho do souboru
foreach ($user in $users) {
    $username = $user.Username
    $password = $user.Password

    # použijeme OpenSSL pro vytvoření správného APR1 hashe
    $hash = & openssl passwd -apr1 $password

    # přidáme uživatele do souboru
    "$($username):$($hash)" | Out-File -Encoding ascii -FilePath $htpasswdPath -Append

    Write-Host "Přidán uživatel $username s heslem $password"
}

#  Výsledek
Write-Host "`nSoubor .htpasswd byl úspěšně vytvořen:"
Write-Host $htpasswdPath
Get-Content $htpasswdPath
